/*! iswear 22-06-2015 */
function Promise(value,status){this.value=value,this.status=status||waiting,bindAll(this,"then","catch","serve","ditch","spark","extinguish")}function Deferred(promise){this.promise=promise,bindAll(this,"resolve","reject")}function bind(func,ctx){var ctxArgs=Array.prototype.slice.call(arguments,2);return function(){var allArgs=ctxArgs.concat(Array.prototype.slice.call(arguments));return func.apply(ctx,allArgs)}}function bindAll(obj){for(var key,i=1,length=arguments.length;length>i;i++)key=arguments[i],obj[key]=bind(obj[key],obj);return obj}function resolvable(cb,_failure,success){cb(function(err,data){err?_failure(err):success(data)})}function swearify(cb,ctx){return function(){var args=Array.prototype.slice.call(arguments),sworn=defer(),handle=function(handler){cb.apply(ctx,args.concat([handler]))};return resolvable(handle,sworn.reject,sworn.resolve),sworn.promise}}function resolved(val){return new Promise(val,resolved)}function rejected(error){return new Promise(error,rejected)}function defer(){return new Deferred(new Promise)}var rejected={},resolved={},waiting={},eMsg="Too strong of a fear of failure can be crippling",pMsg="Don't promise more than you can deliver...";Promise.prototype.then=function(success,_failure){if(this.later)throw new Error(pMsg);return this.later=success,this.battersBox=defer(),this.status===resolved&&this.serve(this.value,!0),_failure&&this["catch"](_failure),this.battersBox.promise},Promise.prototype["catch"]=function(failure){if(this.forFailure)throw new Error(eMsg);this.forFailure=failure,this.status===rejected&&this.ditch(this.value,!0)},Promise.prototype.serve=function(data,override){if(this.status!==waiting&&!override)throw new Error(pMsg);this.status=resolved,this.later&&(this.value=this.later(data),this.spark())},Promise.prototype.ditch=function(error,override){if(this.status!==waiting&&!override)throw new Error(pMsg);this.status=rejected,this.extinguish(error)},Promise.prototype.spark=function(){this.value&&this.value.then&&(this.value.then(this.battersBox.resolve),this.value["catch"](this.battersBox.reject))},Promise.prototype.extinguish=function(error){this.forFailure?(this.value=error,this.forFailure(error)):this.battersBox&&this.battersBox.reject(error)},Deferred.prototype.resolve=function(data){this.promise.serve(data)},Deferred.prototype.reject=function(error){this.promise.ditch(error)},module.exports={swearify:swearify,defer:defer,resolved:resolved,rejected:rejected};